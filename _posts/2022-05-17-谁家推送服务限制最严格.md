---
layout:     post
title:      谁家推送服务限制最严格
subtitle:   序列未来！
date:       2022-05-17
author:     YSY
header-img: img/home-bg.jpg
catalog: true
tags:
    - Android
---

>  先说句题外话，又过了这么多年了，没想到国内Android的统一推送还是没有实现。

由于工作需要，最近正好在调研各家系统推送服务，我发现从他们的技术文档可以分析出很多有意思的东西，比如说能看出来哪家厂商的推送限制最严格，最考虑用户的综合体验。在讲解之前，我们先简单提几个推送服务的基本概念：

- 设备：用户所持有的某台设备，在技术文档中所提到的日活跃用户数一般也就指日联网设备数
- 应用：某台设备上安装的某个应用，后续我们所描述的推送数量限制都是以此维度比较的
- 推送：应用进程活跃或关闭时，通过系统级的推送通道下发消息，一般以通知消息的形式呈现给用户，点击后激活应用进程
- 透传：仅在应用活跃时可接收数据，仍然依赖系统的推送服务器下发，但数据格式一般可以自定义，处理逻辑也是由应用自己实现，所以应用如果被杀死，自然就处理不到了

一个不那么规范的示意图：

![在这里插入图片描述](https://img-blog.csdnimg.cn/4e5fce56c25947ecb2b67d3ecf168b47.png)

**注：下文以x表示日联网设备数量；我们主要关注推送，不过多说明透传的限制。**

### 各家次数限制

#### 华为

对于某设备某应用，推送和透传次数总共不超过**3000次/每日**；相当于该应用每日推送总量上限为：`f(x) = 3000 * x`

简要解读：华为严格限制了某设备某应用所能接收的推送数量，所以对于某应用而言，推送总量和设备数量线性相关。

#### 小米

透传没有数量限制，而推送分为**普通级别**和**重要级别**，重要级别的消息（比如即时通讯消息、个人订单状态变化等）没有数量限制，但需要单独向小米团队申请。下面只说明普通级别的消息：

对于某应用，推送总量上限为**x的数倍/每日**，这个倍数和你的应用分类有关，比如新闻资讯是5倍，时尚购物是2倍，我们以最低的2倍为例，该应用每日推送总量上限为：

- 当x < 10000时，`f(x) = 2 * 10000 = 20000`
- 当x >= 10000时，`f(x) = 2 * x`

简要解读：从小米推送的官方文档来看，和华为不同，并没有明确限制某设备某应用接收的数量，只限制了某应用对于所有设备的推送总量，换言之，极端情况下，我可以把这个额度全部推给某一台设备。所以你的用户少到一定程度时，单台设备可接收的推送数量会远大于华为的3000次限制。当然，这种极端情况其实属于一种漏洞了，虽然文档确实没有说明，但估计是不可行的。

#### OPPO

不支持透传，推送分为**公信**和**私信**，私信类似小米的重要级别消息，不限量，需要单独申请。下面只说明公信：

对于某应用，推送总量上限为**2x/每日**，该应用每日推送总量上限为：

- 当x < 50000时，`f(x) = 2 * 50000 = 100000`
- 当x >= 50000时，`f(x) = 2 * x`

对于某设备，公信和私信总和接收数上限为**2000/每日**。

简要解读：OPPO的规则和小米非常类似，但没有像小米那样按应用分类给不同的倍数，而是固定为2倍。且对于某设备，无论公信还是私信，每日接收推送的总和上限为2000，也就是说该设备无论有多少个应用接入了OPPO推送，其每日接收总量固定。所以即便你申请了私信总量无限，但单一用户仍然有限。

#### vivo

不支持透传，推送分为**运营消息**和**系统消息**，类似小米和OPPO，但又不尽相同，vivo的系统消息默认是可以直接使用的，不向小米和OPPO那样需要申请，只不过每日推送总量限制与运营消息相同，为**x的1倍**。系统消息虽然在文档中声称**不限制某设备某应用的接收数量**，但实际上有总量限制，所以某一台设备接收最大数也就是总量，如果需要增量再向官方申请（但至于可以申请多少，肯定也不是无限的）。下面只说明运营消息：

对于某应用，推送总量上限为**x/每日**，该应用每日推送总量上限为：

- 当x < 10000时，`f(x) = 10000`
- 当x >= 10000时，`f(x) = x`

对于某设备某应用，运营消息接收数上限为**5/每日**，系统消息则为**无限/每日**。

简单解读：vivo的限制规则和其他家有很大不同，对于某设备某应用的普通运营消息做了很严格的控制，每天仅为5条，因此该设备当天总接收量取决于所安装的集成了vivo系统推送的应用数，这和OPPO直接限制成2000/每日有些许差异。

### 横向对比

在分析完上述各家推送的文档之后，我们从两个角度来进行对比。

#### 从开发者角度

作为应用开发者，我们比较关心的是每天总共可以推送多少消息出去，将上文函数绘制出来就非常清楚了：

![在这里插入图片描述](https://img-blog.csdnimg.cn/bad73233601542c4b7fd74125153a8be.png#pic_center)

在单个应用每天可推送总量这个指标上看，华为对应函数的斜率是3000，可谓是一骑绝尘，给到普通开发者的资源也算非常慷慨的了。然后再单独看其他三家吧：

- 当设备数小于1万时，可推送总量：OPPO > 小米 > vivo。
- 当设备数介于1万到5万之间时，可推送总量依然是：OPPO > 小米 > vivo，但小米与vivo的差距随着设备数增多而增大；
- 当设备数大于5万时，可推送总量：OPPO = 小米 > vivo，此时OPPO和小米已经一致，并与vivo的差距越来越大。

因此对开发者来说，总体上可推送数量对比：华为 > OPPO > 小米 > vivo。~~没错，产品运营同学们可以对华为用户加大营销力度了。~~

#### 从用户角度

刚刚提到的总量其实并不是用户最关心的，由于各家厂商的规则各异，我们更关心的是**某设备每天能收到的推送数量上限**。

因此我们**以y表示某设备所安装的应用数**（接入了对应系统推送的），得出如下函数：

- 华为：`f(y) = 3000 * y`
- 小米：由于其官方文档并没有对设备维度作说明，只能按平均值计算，所以是`f(y) = (2 + 5) / 2 * y = 3.5 * y`，2和5分别为上文提到的不同应用分类限制倍数的最小值和最大值，其实更为合理的是按所安装应用类型的分布来计算。
- OPPO：与安装应用数量无关，`f(y) = 2000`
- vivo：`f(y) = 5 * y`

![在这里插入图片描述](https://img-blog.csdnimg.cn/bc8747ae84f048958bff82a0db5e0865.png#pic_center)

由图可知，对用户来讲，不同厂商推送对所安装应用数量的敏感度是不一样的，每天能收到的推送数量上限情况如下：

- 当安装应用数量小于400时，华为 > OPPO > vivo > 小米
- 当安装应用数量介于400到（约）571时，华为 > vivo > OPPO > 小米
- 当安装应用数量大于（约）571时，华为 > vivo > 小米 > OPPO

总体看来，华为依然是一骑绝尘，不管你安装多少应用，收到的推送数量都是最多的，换言之，也是理论上用户体验最不好的。从函数图像上来看，结合实际情况（一般人不会安装超过400个应用）vivo和小米推送是管控相对较为严格的，理论上用户体验最佳。OPPO相对而言比较简单粗暴，这对于轻度用户来说不是很友好。

上述结论是完全基于官方文档的说明来进行的数据分析，它更多是表明了对于开发者和用户的可影响程度。在实际体验中，几家厂商并没有太大差异，最终影响用户设备接收推送体验的因素也非常复杂，可能应用的开发者针对不同用户也有不同频次的推送，也可能用户有自己的应用设置习惯，所以每个人的感受也千差万别。此外，即便开发者不对用户体验负责，厂商的推送平台还是会对大家负责的，毕竟任何异常量级的数据都会受到风控的，而且对于滥用推送的开发者，平台也会有相应的处罚机制。

### 参考

- [小米文档中心](https://dev.mi.com/console/doc/detail?pId=2086)
- [华为推送服务](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-Guides/faq-0000001050042183#section196822541234)
- [OPPO开放平台](https://open.oppomobile.com/wiki/doc#id=11210)
- [vivo开放平台](https://dev.vivo.com.cn/documentCenter/doc/359#_Toc64906673)

### 关于Apple

我也看了一下Apple的推送服务文档，并没有提到相关的限制，所以我这里没有做相关分析，也许要开发者帐号才能查看？欢迎熟悉这方面业务的同学评论。
